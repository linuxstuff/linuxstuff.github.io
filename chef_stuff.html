<h1>Chef resources ...</h1>

<p><strong>ignore_failure during converge phase</strong></p>

<blockquote>
<pre><code>gem_package "syntax" do
action :install
ignore_failure true
end
</code></pre>
</blockquote>

<hr />

<p><strong>Use the supports and providers common attributes</strong></p>

<blockquote>
<pre><code>service "some_service" do
 provider Chef::Provider::Service::Upstart
 supports :status =&gt; true, :restart =&gt; true, :reload =&gt; true
 action [ :enable, :start ]
end
</code></pre>

<p>* specify a given provider for service using short or long name approach </p>
</blockquote>

<hr />

<p><strong>Guards example</strong> </p>

<blockquote>
<pre><code>template "/tmp/somefile" do
mode '0644'
source "somefile.erb"
not_if do
  File.exists?("/etc/passwd")
end
end
</code></pre>
</blockquote>

<hr />

<p><strong>Lazy Attribute Evaluation</strong></p>

<blockquote>
<pre><code>template "template_name" do
 path lazy { " some Ruby code " }
end
</code></pre>

<p>* the Ruby code will be evaluated in the execution phase</p>
</blockquote>

<hr />

<p><strong>Notifies</strong></p>

<blockquote>
<pre><code>template "/etc/nagios3/configures-nagios.conf" do
 # other parameters
 notifies :run, "execute[test-nagios-config]", :immediately
end 

execute "test-nagios-config" do
 command "nagios3 --verify-config"
 action :nothing
end
</code></pre>

<p>* the execute resource will be triggered after the template resource is executed.</p>
</blockquote>

<hr />

<p><strong>Subscribe</strong></p>

<blockquote>
<pre><code>template "/tmp/somefile" do
 mode '0644'
 source "somefile.erb"
end

service "apache" do
 supports :restart =&gt; true, :reload =&gt; true
 action :enable
 subscribes :reload, "template[/tmp/somefile]", :immediately
end
</code></pre>

<p>* service apache resource will be triggered each time when template "/tmp/somefile" is executed</p>
</blockquote>

<hr />

<p><strong>Run Resources from the Resource Collection</strong></p>

<ul>
<li>Run a resource before all other resources are added to the resource collection and/or after all resources have been added, but before the chef-client configures the system.</li>
<li><p>Run before other resources
<blockquote>
  <p></p></p>
</blockquote>

<blockquote>
<pre><code>e = execute "apt-get update" do
 action :nothing
end
e.run_action(:run)
</code></pre>
</blockquote></li>
<li><p>To run a resource at the end of the resource collection phase of the chef-client run, use the :delayed timer on a notification.</p></li>
</ul>

<hr />

<p><strong>Steps in chef-cliet run</strong></p>

<ul>
<li>http://docs.getchef.com/essentials<em>nodes</em>chef_run.html </li>
<li><strong>Get configuration data</strong>:  local client.rb file + ohai </li>
<li><strong>Authenticate to the Chef Server</strong>: RSA priv key + node name against chef API</li>
<li><strong>Get, rebuild the node object</strong>: node object is rebuild </li>
<li><strong>Expand the run-list</strong>: ..</li>
<li><strong>Synchronize cookbooks</strong>: gets the list of cookbooks, compare with existing files in cache. Chef client is able to request the cookbooks at the beginning</li>
<li><strong>Reset node attributes</strong>: All attributes in the rebuilt node object are updated with the attribute data according to attribute precedence</li>
<li><strong>Compile the resource collection</strong>: "The chef-client identifies each resource in the node object and builds the resource collection....Finally, all recipes are loaded in the order specified by the expanded run-list." </li>
<li><strong>Converge the node</strong>: "Each resource is executed in the order identified by the run-list, and then by the order in which each resource is listed in each recipe."</li>
<li><strong>Update the node object, process exception and report handlers</strong>: "chef-client updates the node object on the Chef server with the node object that was built during this chef-client run...exception and report handlers are executed"</li>
<li><strong>Stop, wait for the next run</strong> </li>
</ul>

<hr />

<h1>Resources that are build in</h1>

<ul>
<li><strong>apt_package</strong></li>
<li><strong>bash</strong></li>
<li><strong>batch</strong> , for windows </li>
<li><strong>breakpoint</strong> , add breakpoints to recipes, then run the chef-client in chef-shell mode.</li>
<li><strong>chef_gem</strong>, install a gem only for the instance of Ruby that is dedicated to the chef-client. It is done before convergence, allowing a gem to be used in a recipe immediately after it is installed.</li>
<li><strong>chef<em>handler</strong> , types: start(in config.rb), report(by chef</em>handler), error (by chef_handler or config.rb) </li>
<li><p><strong>cookbook<em>file</strong> ,  transfer files from a sub-directory of COOKBOOK</em>NAME/files/ </p>

<blockquote>
<pre><code> cookbook_file "application.pm" do 
 path case node['platform']
   when "centos","redhat"
    "/usr/lib/version/1.2.3/dir/application.pm"
   when "arch"
    "other file"
   else
    "other file"
   end
 source "application-#{node['languages']['perl']['version']}.pm"
 owner 'root'
 end
</code></pre>
</blockquote></li>
<li><p><strong>cron</strong>, resource should only be used to modify an entry in a crontab file</p></li>
<li><strong>cdh</strong>, execute scripts using the csh interpreter</li>
<li><p><strong>deploy</strong>,  manage and control deployments. The deploy resource is designed to behave in a way that is similar to the deploy and deploy:migration tasks in Capistrano</p>

<blockquote>
<pre><code>deploy "/my/deploy/dir" do
repo "git@github.com/whoami/project"
revision "abc123" # or "HEAD" or "TAG_for_1.0" or (subversion) "1234"
user "deploy_ninja"
enable_submodules true
migrate true
migration_command "rake db:migrate"
environment "RAILS_ENV" =&gt; "production", "OTHER_ENV" =&gt; "foo"
shallow_clone true
keep_releases 10
action :deploy # or :rollback
restart_command "touch tmp/restart.txt"
git_ssh_wrapper "wrap-ssh4git.sh"
scm_provider Chef::Provider::Git # is the default, for svn: Chef::Provider::Subversion
end
</code></pre>
</blockquote></li>
<li><p><strong>directory</strong>, manage directories</p>

<blockquote>
<pre><code> %w{dir1 dir2 dir3}.each do |dir|
 directory "/tmp/mydirs/#{dir}" do
   mode '0775'
   owner 'root'
   group 'root'
   action :create
   recursive true
 end
 end
</code></pre>
</blockquote></li>
<li><p><strong>dpkg_package</strong>, In many cases, it is better to use the package resource instead of this one. This is because when the package resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application</p></li>
<li><strong>dsc<em>script</strong>, Windows PowerShell 4.0 is required for using the dsc</em>script resource with Chef.</li>
<li><strong>easy<em>install</em>package</strong>, manage packages for the Python platform; use the package resource instead of this one</li>
<li><strong>env</strong>, manage environment keys in Microsoft Windows. After an environment key is set, Microsoft Windows must be restarted before the environment key will be available to the Task Scheduler.</li>
<li><strong>erl_call</strong>, connect to a node located within a distributed Erlang system</li>
<li><strong>execute</strong>, Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use not<em>if and only</em>if to guard this resource for idempotence.</li>
<li><p><strong>file</strong>, manage files directly on a node</p>

<blockquote>
<pre><code> file "/tmp/something" do
 owner 'root'
 group 'root'
 mode '0755'
 content content_string
 action :create
 end
</code></pre>
</blockquote></li>
<li><p><strong>freebsd_package</strong>, manage packages for the FreeBSD platform. In many cases, it is better to use the package resource instead of this one. This is because when the package resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application</p></li>
<li><strong>gem_package</strong>, manage gem packages that are only included in recipes. install gems on the system wide. In many cases, it is better to use the package resource instead of this one</li>
<li><p><strong>git</strong>, manage source control resources that exist in a git repository. </p>

<blockquote>
<pre><code> git "/home/user/deployment" do
  repository "git@github.com:gitsite/deployment.git"
  revision branch_name
  action :sync
  user "user"
  group "test"
 end
</code></pre>
</blockquote></li>
<li><p><strong>group</strong>, manage a local group. </p>

<blockquote>
<pre><code> group "www-data" do
 action :modify
 members "maintenance"
 append true
 end
</code></pre>
</blockquote></li>
<li><p><strong>http_request</strong>, send an HTTP request (GET, PUT, POST, DELETE, HEAD, or OPTIONS) with an arbitrary message. This resource is often useful when custom callbacks are necessary.</p>

<blockquote>
<pre><code> http_request "posting data" do
 action :post
 url "http://example.com/check_in"
 message ({:some =&gt; "data"}.to_json)
 headers({"AUTHORIZATION" =&gt; "Basic #{Base64.encode64("username:password")}","Content-Type" =&gt; "application/data"})
 end
</code></pre>
</blockquote></li>
<li><p><strong>ifconfig</strong>, manage interfaces</p>

<blockquote>
<pre><code>  ifconfig "192.186.0.1" do
 device "eth0"
end
</code></pre>
</blockquote></li>
</ul>
